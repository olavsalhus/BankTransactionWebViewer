@page
<!DOCTYPE html>
<html lang="en" >
<title>Transaction Viewer</title>
<link href="https://unpkg.com/nordigen-bank-ui@1.3.4/package/src/selector.min.css" rel="stylesheet" />

<div class="institution-content-wrapper">
    <div class="institution-modal-content">
        <header class="institution-modal-header">
            <h2>Select your bank:</h2>
        </header>
    </div>
</div>

<script src="https://unpkg.com/nordigen-bank-ui@1.3.4/package/src/selector.min.js"></script>
    
<script>
    const fetchJson = url => fetch(url).then(response => response.json())

    fetchJson("/GetAccessToken").then(token => {
        if (typeof token.access === 'undefined') {
            alert(`${JSON.stringify(token)}\n\nFill in missing API keys in BankWeb/Services/NordigenService.cs`)
        }
        fetchJson(`/GetBanks?access_token=${token.access}`).then(WithListOfBanks)
    })

    function WithListOfBanks(listOfBanks) {
        config = {
            logoUrl: 'https://cdn.nordigen.com/ais/Nordigen_Logo_Black.svg',
            text: 'Login to your bank to show transactions or ',
            countryFilter: true
        };

        new institutionSelector(listOfBanks, 'institution-modal-content', config);
        var demoLink = document.createElement('a')
        demoLink.href = "/BankLogin?bank=SANDBOXFINANCE_SFIN0000"
        demoLink.innerText = "use a DEMO bank account";
        document.querySelector('.container-onboarding p').appendChild(demoLink)
        const observer = new MutationObserver((event) => {
            const institutions = Array.from(document.querySelectorAll('.ob-list-institution > a'));
            institutions.forEach((institution) => {
                institution.href = `/BankLogin?bank=${institution.dataset.institution}`
            })
        });

        observer.observe(document.querySelector(".institution-container"), { childList: true });
    }
</script>
